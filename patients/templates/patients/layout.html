{% load static %}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="ХОБЛ" content="Липецкая городская поликлиника №2" />
    <meta name="ХОБЛ" content="ХОБЛ - пациенты">
    <link rel="icon" type="image/png" href="{% static 'login/images/favicon.png' %}">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <!-- Document title -->
    <title>{% block title %}{% endblock %}</title>

    <!-- Stylesheets & Fonts -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css"
          rel="stylesheet"
          integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9"
          crossorigin="anonymous">

    <link href="{% static 'public/css/plugins.css' %}" rel="stylesheet">
    <link href="{% static 'public/css/style.css' %}" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'patients/css/patients.css' %}">
    <link href="{% static 'public/js/plugins/bootstrap-switch/bootstrap-switch.css' %} " rel="stylesheet">
</head>

<body>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm"
        crossorigin="anonymous"></script>

    <!-- Body Inner -->
    <div class="body-inner">
        <!-- Header -->
        <header id="header" data-fullwidth="true">
            <div class="header-inner">
                <div class="container">
                    <!--Logo-->
                    <div id="logo">
                        <a href="{% url 'home:index' %}">
                            <span class="logo-default">ХОБЛ</span>
                            <span class="logo-dark">ХОБЛ</span>
                        </a>
                    </div>
                    <!--End: Logo-->

                    <!--Navigation Resposnive Trigger-->
                    <div id="mainMenu-trigger">
                        <a class="lines-button x"><span class="lines"></span></a>
                    </div>
                    <!--end: Navigation Resposnive Trigger-->
                    <!--Navigation-->
                    <div id="mainMenu">
                        <div class="container">
                            <nav>
                                <ul>
                                    <li class="dropdown"><a href="#">Пациенты</a>
                                        <ul class="dropdown-menu">
                                            <li><a href= "{% url 'patients:browse' %}">Просмотр</a></li>
                                            <li><a href="{% url 'patients:add' %}">Добавить</a></li>
                                        </ul>
                                    </li>
                                    {% if dispensary_alert %}
                                      <li class="dropdown">
                                        <a href="{% url 'patients:dispensary' %}">
                                            Диспансеризация
                                            <span class="badge bg-danger">Сроки!</span>
                                        </a>
                                      </li>
                                    {% endif %}

                                    <!--
                                    <li class="dropdown"><a href="#">Features</a>
                                        <ul class="dropdown-menu">
                                            <li><a href="#">Sliders</a></li>
                                            <li><a href="widgets.html">Widgets</a></li>
                                            <li><a href="page-loaders.html">Page Loaders<span class="badge bg-danger">NEW</span></a></li>
                                            <li><a href="#">Modal Auto Open<span class="badge bg-danger">NEW</span></a></li>
                                            <li><a href="#">Cookie Notify<span class="badge bg-danger">NEW</span></a></li>
                                        </ul>
                                    </li>
                                    -->

                                    {% if user.is_superuser %}
                                      <li class="dropdown"><a href="#">Управление</a>
                                        <ul class="dropdown-menu">
                                          <li><a href="{% url 'admin:index' %}" target="_blank"><i class="icon-sliders"></i>Админ панель</a></li>
                                          <li><a href="{% url 'admin:auth_user_changelist' %}" target="_blank"><i class="icon-user"></i>Пользователи</a></li>
                                          <li><a href="{% url 'admin:auth_group_changelist' %}" target="_blank"><i class="icon-users"></i>Список групп</a></li>
                                          <li><a href="{% url 'admin:patients_copdpatients_changelist' %}" target="_blank"><i class="icon-database"></i>БД пациентов</a></li>
                                        </ul>
                                      </li>
                                    {% endif %}

                                    <li>
                                        <a href="{% url 'authorization:logout' %}"><span>Выход</span></a>
                                    </li>
                                </ul>
                            </nav>
                        </div>
                    </div>
                    <!--end: Navigation-->
                </div>
            </div>
        </header>
        <!-- end: Header -->
        <!-- Page title -->
        <section id="page-title">
            <div class="container">
                <div class="page-title">
                    <h1>Пациенты</h1>
                    <span>ХОБЛ / ХНЗЛ</span>
                </div>
                <div class="breadcrumb">
                    <ul>
{#                        <li><a href="#">Home</a> </li>#}
{#                        <li><a href="#">Shortcodes</a> </li>#}
{#                        <li class="active"><a href="#">Form Layouts</a> </li>#}
                        {% for item in breadcrumb_data %}
                          <li>
                              <a href="{{ item.url }}" {% if forloop.last %}class="breadcrumb_link_active"{% endif %}>
                                {{ item.label }}
                              </a>
                          </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </section>
        <!-- end: Page title -->
        <!-- Page Menu -->
        <!--  <div class="page-menu">
            <div class="container">
                <nav>
                    <ul>
                        <li class="active"><a href="shortcode-forms-basic.html">Basic</a></li>
                          </ul>
                </nav>
                <div id="pageMenu-trigger">
                    <i class="fa fa-bars"></i>
                </div>
            </div>
        </div> -->
        <!-- end: Page Menu -->

        <!-- Page Content -->
        {% block content %}{% endblock %}
        <!-- end: Page Content -->

        <!-- Footer -->
        <footer id="footer">
            <div class="footer-content">
                <div class="container">
                    <div class="row">
                        <div class="col-lg-5">
                            <div class="widget">
                                <div class="widget-title">ХОБЛ / ХНЗЛ</div>
                                <p class="mb-5">Данные для регистра ХОБЛ<br> Все права защищены. Copyright © 2023</p>
                                <a href="http://lip2.ru"
                                   class="btn btn-inverted"
                                   target="_blank"
                                >Перейти на сайт поликлиники</a>
                            </div>
                        </div>
                        <div class="col-lg-7">
                            <div class="row">
                                <div class="col-lg-3">
                                    <div class="widget">
                                        <div class="widget-title">Пациенты</div>
                                        <ul class="list">
                                            <li><a href="{% url 'patients:browse' %}">Просмотр</a></li>
                                            <li><a href="{% url 'patients:add' %}">Добавить</a></li>
                                        </ul>
                                    </div>
                                </div>

                                <!--
                                <div class="col-lg-3">
                                    <div class="widget">
                                        <div class="widget-title">Features</div>
                                        <ul class="list">
                                            <li><a href="#">Layouts</a></li>
                                            <li><a href="#">Headers</a></li>
                                            <li><a href="#">Widgets</a></li>
                                            <li><a href="#">Footers</a></li>
                                        </ul>
                                    </div>
                                </div>
                                -->

                                <!--
                                <div class="col-lg-3">
                                    <div class="widget">
                                        <div class="widget-title">Pages</div>
                                        <ul class="list">
                                            <li><a href="#">Portfolio</a></li>
                                            <li><a href="#">Blog</a></li>
                                            <li><a href="#">Shop</a></li>
                                        </ul>
                                    </div>
                                </div>
                                -->


                                {% if user.is_superuser %}
                                    <div class="col-lg-3">
                                        <div class="widget">
                                            <div class="widget-title">Управление</div>
                                            <ul class="list">
                                              <li><a href="{% url 'admin:index' %}" target="_blank"><i class="icon-sliders"></i> Админ панель</a></li>
                                              <li><a href="{% url 'admin:auth_user_changelist' %}" target="_blank"><i class="icon-user"></i> Пользователи</a></li>
                                              <li><a href="{% url 'admin:auth_group_changelist' %}" target="_blank"><i class="icon-users"></i> Список групп</a></li>
                                              <li><a href="{% url 'admin:patients_copdpatients_changelist' %}" target="_blank"><i class="icon-database"></i> БД пациентов</a></li>
                                            </ul>
                                        </div>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="copyright-content">
                <div class="container">
                    <div class="copyright-text text-center">&copy; 2023 ХОБЛ - все права защищены</a> </div>
                </div>
            </div>
        </footer>
        <!-- end: Footer -->
    </div>
    <!-- end: Body Inner -->
    <!-- Scroll top -->
    <a id="scrollTop"><i class="icon-chevron-up"></i><i class="icon-chevron-up"></i></a>

    <!--Plugins-->
    <script src="{% static 'public/js/jquery.js' %}"></script>
    <script src="{% static 'public/js/plugins.js' %}"></script>

    <!--Template functions-->
    <script src="{% static 'public/js/functions.js' %}"></script>
    <script src="{% static 'patients/js/imask-date.js' %}"></script>

    <!-- jQuery Validate plugin files-->
    <script src="{% static 'public/js/plugins/validate/validate.min.js' %}"></script>
    <script src="{% static 'public/js/plugins/validate/valildate-rules.js' %}"></script>
    <script src="{% static 'public/js/plugins/bootstrap-switch/bootstrap-switch.min.js' %}"></script>
</body>
</html>

<!-- ** -->

{% url 'patients:add' as add_url %}
{% url 'patients:edit' patient_id=patient.id as edit_url %}


<!-- вычисляем сколько лет -->
{% if request.path in add_url or edit_url %}
  <script>
    {#document.getElementById('id_birthday').addEventListener('change', function () {#}
    document.getElementById('id_birthday').addEventListener('blur', function () {
      let birthday = new Date(this.value);
      let today = new Date();
      let age = today.getFullYear() - birthday.getFullYear();
      let m = today.getMonth() - birthday.getMonth();

      if (m < 0 || (m === 0 && today.getDate() < birthday.getDate())) {
        age--;
      }

      document.getElementById('id_age').value = age;
    });
  </script>
{% endif %}


<!-- создаем маску ввода при редактировании -->
{% if request.path in edit_url %}
  <script>
    window.onload = function() {
      initializeMaskedInput('id_birthday');
      initializeMaskedInput('id_year_of_diagnosis_of_COPD');
      initializeMaskedInput('id_consists_under_DN');
      initializeMaskedInput('id_dispensary_observation_date_status');
    };

    function initializeMaskedInput(inputId) {
      var inputElement = document.getElementById(inputId);

      // Устанавливаем фокус в начало строки при фокусе на поле ввода
      inputElement.addEventListener('click', function () {
        selectText(inputElement);
      });

      MaskedInput({
        elm: inputElement,
        format: '____-__-__',
        separator: '-'
      });
    }

    // Функция для выделения всего текста в поле ввода
    function selectText(input) {
      input.setSelectionRange(0, input.value.length);
    }
  </script>
{% endif %}
